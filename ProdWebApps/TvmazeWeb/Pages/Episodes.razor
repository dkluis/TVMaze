@page "/episodes"

@using TVMazeWeb.Data
@inject WebEpisodes WebEpisodesService

@code{
    AppInfo appinfo = new("Tvmaze", "WebUI", "DbAlternate");
    private List<EpisodeInfo> EpisodesInfoList = new();
    string SearchString;
    string SeasonString;
    string EpisodeString;

    private void FindEpisodes()
    {
        if (SeasonString is null) { SeasonString = ""; }
        if (EpisodeString is null) { EpisodeString = ""; }
        if (SearchString is null) { SearchString = ""; }
        EpisodesInfoList = WebEpisodesService.GetEpisodes(appinfo, SearchString, SeasonString, EpisodeString);
    }
}

<h1>Episodes</h1>
<em>To manually set Watched, Acquired or Skipped use TVMaze Episode Url</em>
<div>

    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text">ShowName %</span>
        </div>
        <input @bind="SearchString" />
        <div class="input-group-append">
            <span class="input-group-text">%</span>
        </div>
        <div class="input-group-prepend">
            <span class="input-group-text">Season</span>
        </div>
        <input @bind="SeasonString" />
        <div class="input-group-prepend">
            <span class="input-group-text">Episode</span>
        </div>
        <input @bind="EpisodeString" />
        &#8195;<button class="btn btn-primary" @onclick="FindEpisodes">Find Episodes</button>
    </div>
</div>

<p></p>

<p></p>

<div>
    <h6>Shows - Table</h6>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Show Id</th>
                <th>Name</th>
                <th>Season</th>
                <th>Episode</th>
                <th>Broadcast Date</th>
                <th>Episode Url</th>
                <th>Status</th>
                <th>Status Date</th>
                <th>Update Date</th>
            </tr>
        </thead>
        <tbody>
            @if (EpisodesInfoList.Count() == 0)
            {
                <tr>No Episode Information Found</tr>
            }
            else
            {
                foreach (EpisodeInfo ei in EpisodesInfoList)
                {
                    <tr>
                        <td>@ei.TvmShowId</td>
                        <td>@ei.ShowName</td>
                        <td>@ei.Season</td>
                        <td>@ei.Episode</td>
                        <td>@ei.BroadcastDate</td>
                        <td> <a href="@ei.TvmUrl" target="_blank">TVMaze</a> </td>
                        <td>@ei.PlexStatus</td>
                        <td>@ei.PlexDate</td>
                        <td>@ei.UpdateDate</td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>
